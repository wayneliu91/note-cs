# 设计目的

- ZooKeeper是一个分布式协调服务，主要用来解决分布式系统中的一致性问题和数据管理问题。

- 本质上是一个分布式文件系统，适合存储小文件(最好不要超过1MB)。

# 应用场景

- 分布式锁(排它锁，共享/读锁)。
- 服务注册和发现。
- 共享配置和状态信息。

# 组成模块

## 服务端

### Leader

- 一个集群同一时间只能有一个Leader。
- 作用是：发起并维护与各Follower及Observer间的心跳。
- 所有的写操作必须通过Leader完成，再由Leader将写操作广播给其他服务器。
- 投票。

### Follower

- 一个集群可同时存在多个Follower，会影响Leader的心跳。
- 直接处理客户端的读请求；
- 将写请求转发给Leader处理；
- 参与集群投票；

### Observer

- 与Follower类似，但无投票权。

## 客户端

- 发起请求 

# 工作机制

## 启动时

1. 每个Server投自己一票，票的组成是键值对，键为myid，值为zxid；然后把票发给集群中的其他机器。
   - myid：表示服务器编号，越大权重越大。
   - zxid：事务ID，越大表示数据越新。
2. 接收其他机器的投票。
   - 收到投票后判断票的有效性(是否本轮投票、是否来自looking状态的服务器等)。
3. 处理投票。
   - 循环其他投票，和自己的票pk；优先检查zxid，大的(数据新)胜；如果相等，比较myid，大的胜。
   - 对于Server1，因为Server2比自己的票大，于是更新自己的票；对于Server2，无需更新，只是再次向集群其他机器发出一次投票信息即可。
4. 统计投票。
   - 如果有过半机器

## Leader宕机时

