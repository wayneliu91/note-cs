# 原型模式

对于熟悉 JavaScript 语言的前端程序员来说，原型模式是一种比较常用的开发模式。这是因为，有别于 Java、C++ 等==基于类==的面向对象编程语言，JavaScript 是一种==基于原型==的面向对象编程语言。即便 JavaScript 现在也引入了类的概念，但它也只是基于原型的语法糖而已。

不过，如果你熟悉的是 ==Java、C++ 等这些编程语言==，那在==实际的开发中==，就==很少用到==原型模式了。

## 原理与应用

如果对象的==创建成本比较大==，而==同一个类==的==不同对象==之间==差别不大==（大部分字段都相同），在这种情况下，我们可以利用对==已有对象==（原型）进行==复制==（或者叫拷贝）的方式来创建新对象，以达到==节省创建时间==的==目的==。这种基于原型来创建对象的方式就叫作**原型设计模式**（Prototype Design Pattern），简称**原型模式**。

### 何为“对象的创建成本比较大”？

实际上，创建对象包含的==申请内存、给成员变量赋值==这一过程，本身并不会花费太多时间，或者说==对于大部分业务系统==来说，这点时间完全是可以忽略的。应用一个复杂的模式，只得到一点点的性能提升，这就是所谓的过度设计，得不偿失。

但是，如果==对象中的数据==需要==经过复杂的计算才能得到==（比如排序、计算哈希值），或者需要==从 RPC、网络、数据库、文件系统==等非常慢速的 ==IO 中读取==，这种情况下，我们就可以利用原型模式，从其他已有对象中直接拷贝得到，而不用每次在创建新对象的时候，都重复执行这些耗时的操作。

## 两种实现方式

浅拷贝和深拷贝的区别：

- 浅拷贝只会复制索引，不会复制数据本身。
- 深拷贝不仅仅会复制索引，还会复制数据本身。

浅拷贝得到的对象跟原始对象==共享数据==，而深拷贝得到的是一份==完完全全独立==的对象。

### 如何实现深拷贝？

- 第一种方法：==递归拷贝==对象、对象的引用对象以及引用对象的引用对象，==直到==要拷贝的对象只包含基本数据类型数据，==没有引用对象为止==。
- 第二种方法：先将对象==序列化==，然后再==反序列化==成新的对象。

两种实现方法，不管采用哪种，深拷贝都要比浅拷贝耗时、耗内存空间。

如果要拷贝的对象是不可变对象，浅拷贝共享不可变对象是没问题的，但对于可变对象来说，浅拷贝得到的对象和原始对象会共享部分数据，就有可能出现数据被修改的风险，也就变得复杂多了。

除非操作非常耗时，这种情况下比较推荐使用浅拷贝，否则，==没有充分的理由，不要为了一点点的性能提升而使用浅拷贝==。
