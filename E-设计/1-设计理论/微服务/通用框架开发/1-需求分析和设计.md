# 1-需求分析和设计

## 需求分析

作为一个跟**业务无关**的功能，我们完全可以把它开发成一个独立的框架或者类库，集成到很多业务系统中。而作为**可被复用**的框架，除了**功能性需求**之外，**非功能性需求**也非常重要。所以，接下来，我们从这两个方面来做需求分析。

### 1.功能性需求分析

相对于一大长串的文字描述，人脑更容易理解**短的、罗列的比较规整、分门别类的**列表信息。显然，刚才那段需求描述不符合这个规律。我们需要把它**拆解**成一个一个的“干条条”。

除此之外，我们还可以借助**设计产品**的时候，经常用到的**线框图**，把**最终产品的显示样式**画出来，会更加一目了然。

### 2.非功能性需求分析

对于这样一个通用的框架的开发，我们还需要考虑很多非功能性的需求。具体来讲，有以下几个比较重要的方面。

- 易用性
  - 易用性听起来更像是一个评判产品的标准。没错，我们在开发这样一个技术框架的时候，也要有**产品意识**。框架**是否易集成、易插拔、跟业务代码是否松耦合、提供的接口是否够灵活**等等，都是我们应该花心思去思考和设计的。有的时候，**文档写得好坏**甚至都有可能决定一个框架是否受欢迎。
- 性能
  - 对于需要集成到业务系统的框架来说，我们不希望框架本身的代码执行效率，对业务系统有太多性能上的影响。比如：延迟、框架本身对内存的消耗。
- 扩展性
  - 这里说的扩展性跟**代码的扩展性**有点类似，都是指在**不修改**或**尽量少修改**代码的情况下**添加新的功能**。但是这两者也有区别：
    - 之前讲到的扩展是**从框架代码开发者的角度**来说的。
    - 这里所说的扩展是**从框架使用者的角度**来说的，特指**使用者**可以在**不修改框架源码**，甚至**不拿到框架源码**的情况下，为框架**扩展新的功能**。这就有点**类似给框架开发插件**。

- 容错性
  - 容错性这一点也非常重要。对于性能计数器框架来说，不能因为框架本身的异常导致接口请求出错。所以，我们要对框架**可能存在**的**各种异常情况**都**考虑全面**，**对外暴露的接口**抛出的**所有运行时、非运行时异常**都进行**捕获处理**。
- 通用性
  - 为了提高框架的复用性，能够灵活应用到各种场景中。框架在设计的时候，要**尽可能通用**。我们要多去思考一下，除了接口统计这样一个需求，还可以适用到其他哪些场景中，比如是否还可以处理其他事件的统计信息，比如 SQL 请求时间的统计信息、业务统计信息（比如支付成功率）等。

## 框架设计

对于稍微复杂系统的开发，很多人觉得不知从何开始。可以借鉴 **TDD（测试驱动开发）**和 **Prototype（最小原型）**的**思想**，先**聚焦于**一个**简单的应用场景**，基于此设计实现一个**简单的原型**。尽管这个最小原型系统在功能和非功能特性上都不完善，但它能够**看得见、摸得着**，**比较具体、不抽象**，能够很有效地帮助我们**缕清更复杂的设计思路**，是**迭代设计的基础**。

这就好比做算法题目。当我们想要一下子就想出一个最优解法时，可以**先写几组测试数据**，**找找规律**，再**先想一个最简单的算法**去解决它。虽然这个最简单的算法在时间、空间复杂度上可能都不令人满意，但是我们可以基于此来做优化，这样思路就会更加顺畅。

在**原型系统**的代码实现中，我们可以把所有代码都塞到一个类中，暂时不用考虑任何代码质量、线程安全、性能、扩展性等等问题，**怎么简单怎么来**就行。

小技巧总结：

1. 画产品线框图。
2. 聚焦简单应用场景。
3. 设计实现最小原型。
4. 画系统设计图等

这些**方法的目的**：都是为了让问题简化、具体、明确，提供一个**迭代设计开发**的基础，**逐步推进**。

实际上，不仅仅是软件设计开发，不管做任何事情，**如果我们总是等到所有的东西都想好了再开始，那这件事情可能永远都开始不了**。有句老话讲：**万事开头难**，所以，**先迈出第一步很重要**。
