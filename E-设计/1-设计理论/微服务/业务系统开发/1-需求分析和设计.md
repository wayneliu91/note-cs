# 1-需求分析和设计

针对业务系统的开发，如何做需求分析和设计？

对于一个工程师来说，如果要**追求长远发展**，你就不能一直只把自己放在**执行者的角色**，不能只是一个**代码实现者**，你还要有**独立负责一个系统**的能力，能**端到端**（end to end）开发一个完整的系统。这其中的工作就包括：

- 前期：需求沟通分析。
- 中期：代码设计实现。
- 后期：系统上线维护等。

## 需求分析

作为技术人，我该怎么做产品设计呢？

- 首先，一定不要自己一个人闷头想。
  - 一方面，这样做很难想全面。
  - 另一方面，从零开始设计也比较浪费时间。所以，我们要学会“借鉴”。爱因斯坦说过，“创造的一大秘诀是要懂得如何隐藏你的来源”。你看大师都含蓄地表达了“借鉴”的重要性，我们也没有必要因为“借鉴”而感到不好意思了。
    - 我们可以**找几个类似的产品**，比如淘宝，看看它们是如何设计积分系统的，**然后借鉴到我们的产品中**。
      - 你可以自己**亲自用用**淘宝，看看积分是怎么使用的，
      - 也可以**直接百度一下**“淘宝积分规则”。

基于这两个输入，我们基本上就大致能摸清楚积分系统该如何设计了。

- 除此之外，我们还要**充分了解自己公司的产品**，**将借鉴来的东西糅合在我们自己的产品中**，并做适当的**微创新**。

有了刚刚的笼统、粗糙的功能需求。再考虑业务细节。对于这些业务细节，还是那句话，闷头拍脑袋想是想不全面的。以防遗漏，我们还是要有方法可寻。那除了刚刚讲的“借鉴”的思路之外，我还喜欢通过**产品的线框图**、**用户用例**（user case ）或者叫**用户故事**（user story）来**细化业务流程**，挖掘一些**比较细节**的、**不容易想到**的**功能点**。

**线框图**不赘述，这里重点说一下**用户用例**。用户用例**有点儿类似单元测试用例**。它侧重**情景化**，其实就是**模拟用户如何使用我们的产品**，描述用户在**一个特定的应用场景里**的一个**完整的业务操作流程**。所以，它**包含更多的细节**，且**更加容易被人理解**。

通过上面讲的方法，我们就可以将**功能需求**大致弄清楚了。

## 系统设计

**面向对象设计**聚焦在**代码层面**（主要是针对**类**），那**系统设计**就是聚焦在**架构层面**（主要是针对**模块**），两者有很多相似之处。很多设计原则和思想不仅仅可以应用到代码设计中，还能用到架构设计中。可以借鉴面向对象设计的四个步骤来做系统设计。

### 1.合理地将功能划分到不同模块

面向对象设计的本质就是把**合适的代码**放到**合适的类**中。合理地划分代码可以实现代码的高内聚、低耦合，类与类之间的交互简单清晰，代码整体结构一目了然，那代码的质量就不会差到哪里去。

类比面向对象设计，系统设计实际上就是将**合适的功能**放到**合适的模块**中。合理地划分模块也可以做到模块层面的高内聚、低耦合，架构整洁清晰。

#### 怎么判断哪种模块划分合理呢？

- 实际上，我们可以**反过来**通过看它是否符合高内聚、低耦合特性来判断。**如果一个功能的修改或添加，经常要跨团队、跨项目、跨系统才能完成**，那说明模块划分的**不够合理**，职责不够清晰，耦合过于严重。
- 除此之外，为了避免业务知识的耦合，让下层系统更加通用，一般来讲，我们不希望**下层系统**（也就是**被调用的系统**）包含太多**上层系统**（也就是**调用系统**）的**业务信息**，但是，可以接受上层系统包含下层系统的业务信息。

### 2.设计模块与模块之间的交互关系

在面向对象设计中，类设计好之后，我们需要设计**类之间**的**交互关系**。类比到系统设计，系统职责划分好之后，接下来就是设计**系统之间**的**交互**。

**比较常见**的**系统之间**的**交互方式**有2种：

- 同步接口调用：简单直接。
- 利用消息中间件异步调用：解耦效果更好。

除此之外，**上下层系统之间**的调用倾向于通过**同步接口**，**同层之间**的调用倾向于**异步消息调用**。

### 3.设计模块的接口、数据库、业务模型

刚刚讲了模块的功能划分，模块之间的交互的设计，现在，我们再来看，**模块本身**如何来设计。实际上，业务系统本身的设计无外乎有这样三方面的工作要做：

- 接口设计。
- 数据库设计。
- 业务模型设计。

这部分放在第2章。